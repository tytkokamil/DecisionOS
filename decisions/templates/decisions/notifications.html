{% extends 'decisions/base.html' %}
{% block title %}Notifications - DecisionOS{% endblock %}

{% block content %}
<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem;">
  <h1 style="font-size:2rem;">ðŸ”” Notifications</h1>
  <form method="post" action="{% url 'decisions:notifications_mark_read' %}" id="markReadForm">
    {% csrf_token %}
    <button class="btn" type="submit">Mark all as read</button>
  </form>
</div>

<div class="card">
  {% if notifications %}
    <div style="display:flex; flex-direction:column; gap:1rem;">
      {% for n in notifications %}
        <div style="padding:1rem; border:1px solid var(--border); border-radius:10px; background: {% if not n.is_read %}rgba(0,255,136,0.05){% else %}transparent{% endif %};">
          <div style="display:flex; justify-content:space-between; gap:1rem; align-items:flex-start;">
            <div>
              <div style="font-weight:700;">{{ n.title }}</div>
              {% if n.message %}<div style="color:var(--text-secondary); margin-top:0.25rem;">{{ n.message }}</div>{% endif %}
              <div style="margin-top:0.5rem; font-size:0.85rem; color:var(--text-secondary);">
                {{ n.created_at|date:"Y-m-d H:i" }}
                {% if n.decision %} â€¢ <a href="{% url 'decisions:decision_detail' n.decision.id %}" style="color:var(--accent); text-decoration:none;">Open decision</a>{% endif %}
              </div>
            </div>
            {% if not n.is_read %}
              <span style="color:var(--accent); font-weight:700;">NEW</span>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div style="text-align:center; color:var(--text-secondary); padding:3rem 1rem;">
      No notifications yet.
    </div>
  {% endif %}
</div>

<script>
document.getElementById('markReadForm')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const resp = await fetch(form.action, {method: 'POST', headers: {'X-CSRFToken': form.querySelector('input[name=csrfmiddlewaretoken]').value}});
  if(resp.ok){ window.location.reload(); }
});
</script>
{% endblock %}
